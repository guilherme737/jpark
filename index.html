<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, maximum-scale=0.5" />

    <!--<link rel="stylesheet" type="text/css" href="js/jquery.mobile/jquery.mobile.structure-1.4.0.min.css"> -->
    <link rel="stylesheet" type="text/css" href="js/jquery.mobile.custom/jquery.mobile.custom.structure.min.css">
    <link rel="stylesheet" type="text/css" href="css/GeneralStyle.css">
    <link rel="stylesheet" href="css/fonts.css">


    <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>     
    <script type="text/javascript" src="js/jquery.maskedinput.min.js"></script>

    <!--<script type="text/javascript" src="js/jquery.mobile/jquery.mobile-1.4.0.min.js"></script>-->
    <script type="text/javascript" src="js/jquery.mobile.custom/jquery.mobile.custom.min.js"></script>
  </head>
  <body>     
    <div id="content">
        <div data-role="page" id="credencial"></div>
        <div data-role="page" id="home"></div>
        <div data-role="page" id="checkin"></div>
        <div data-role="page" id="historico"></div>
    </div>  
    <script type="text/javascript">
      $(document).ready(function(){

        var default_url = "http://desenvolvimento.xavante.net.br:82";

        if ('ajaxPrefilter' in $) {
          $.ajaxPrefilter(function(options, originalOptions, xhr) { 
            options.xhrFields = {
                  withCredentials: true
                };
            
            CSRFProtection(xhr); 
          });
        } else {
          $(document).ajaxSend(function(e, xhr) { CSRFProtection(xhr); });
        }

        
        $( document ).on("pagebeforechange", function(e, data) {
          console.log('Verifica usu√°rio: ' + data.toPage);  

          if ( typeof data.toPage === "string" ) {
            var credencial = "#credencial";
            var u = $.mobile.path.parseUrl( data.toPage )
              
            $.get(default_url+'/auth').success(function(auth){              
              if (auth != true && u.hash.search(credencial) === -1) {                
                $.mobile.navigate("#credencial");                
              }            
            });

          }

        });

        $('#credencial').load('login.html');    
        $('#home').load('home.html');        
        //$('#home').load('home.html');        

      });


      function CSRFProtection(xhr) {
        var token = $('meta[name="csrf-token"]').attr('content');
        if (token) 
          xhr.setRequestHeader('X-CSRF-Token', token);
      }

    </script> 
  </body>
</html>  