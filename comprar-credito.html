  
  <style type="text/css">
    
  </style>
  <div class="header">
    <a href="#home" ><img src="imagens/voltar.png" height="16" width="16"/> Voltar</a>
    <h1> Comprar cr&eacute;dito </h1>
  </div>
  <div class="content checkin" align="center" style="color:#ffffff">
    <img src="imagens/logo.png" height="47" width="204"/>  
      <br/><br/>      
      <div style="background-color:#111; padding-top:10px">
        <div>INSTRU&Ccedil;&Otilde;ES DE COMPRA</div>  
        <table>      
          <tr>
            <td>1</td>
            <td style="font-size:0.8em">Confira o saldo</td>
            <td>2</td>
            <td style="font-size:0.8em">Digite o valor em horas</td>
            <td>3</td>
            <td style="font-size:0.8em">Confirme o pagamento</td>
          </tr>
        </table> 
      </div>
      <br/>
      <div style="background-color:#111; padding-top:10px">        
        <div id="saldo-atual" style="font-size:1.5em; padding-bottom: 5px"></div>  
      </div>
      <br/>
      <div style="background-color:#111; padding-top:10px">
        <div>Informe o valor em HORAS que deseja adquirir</div>  
        <div id="valor-hora"></div>  
        <div>
          Comprar valor em:
          <input type="radio" name="tipo-unidade" value="hours" style="margin-left:5px">Horas
          <input type="radio" name="tipo-unidade" value="money" style="margin-left:5px">Reais
        </div>
        <div><input type="text" id="valor" name="valor" style="font-size:2.1em !important; margin-top:5px; width:48%;" maxlength="5" autofocus></div>
        <div style="margin-top:5px;">Confirme sua SENHA e efetive sua compra.</div>  
        <table>      
          <tr>
            <td style="width:50%"><input type="password" id="confirma-senha" name="confirma-senha" style="font-size:1em !important; width:48%;"></td>
            <td><input id="efetuar-pagamento" type="button" value="Pagar com cart&atilde;o &#13;&#10; de cr&eacute;dito" class="button pagar-cartao"/></td>          
          </tr>
        </table>       
      </div>
      <br/><br/>
  </div>
  <div id="modal" >
    <h2>Carregando...</h2>
  </div>
      <script type="text/javascript">

        $(document).ready(function(){

          $.ajax({
            type: "GET",            
            dataType: "json", 
            url: default_url+'/hour_value.json',              
           
            success: function(data) {
              console.log(data);
              $('#valor-hora').html('(Valor por hora: R$ '+ float2moeda(data) +')');
            }            
          });

          $.ajax({
            type: "GET",            
            dataType: "json", 
            url: default_url+'/current_amount.json',
           
            success: function(data) {
              console.log(data);
              $('#saldo-atual').html('(SALDO ATUAL - '+ data +')');
            }, 
            failure: function () {
              alert("Falha ao obter saldo atual.");  
            }
          });


          $('#efetuar-pagamento').click(function() {
            //var default_url = "http://desenvolvimento.xavante.net.br:82";
            $('#modal').show();
            if ( $('#valor').val() > 0 ) {
              $.ajax({
                type: "POST",
                //contentType: "application/json; charset=utf-8", 
                dataType: "json", 
                url: default_url+'/mobile_checkout.json',
                data: { 
                    password_confirmation: $('#confirma-senha').val(),
                    credit_type: $( "input:radio[name=tipo-unidade]:checked" ).val(), //"[hours/money]",
                    order:{
                      value: $('#valor').val()
                    }                                      
                },
                success: function(data) {
                  $('#modal').hide();
                  console.log(data.success);
                  alert(data.message);                
                }, 
                failure: function () {
                  alert("Falha ao efetuar pagamento. Por favor tente novamente.");  
                },
                statusCode: {
                    0: function() {
                        $('#modal').hide();
                        alert('Erro na comunica&ccedil;&atilde;o. Verifique sua conex&atilde;o.');
                    },                
                    500:function() {
                        $('#modal').hide();
                        alert('Erro ao acessar o servidor. Por favor tente mais tarde em alguns minutos.');
                    }
                }
              });
              $('#modal').hide();
            } else {
              alert('Informe um valor maior que zero.');
            }
          })
        })    
            
        function float2moeda(num) {

           x = 0;

           if(num<0) {
              num = Math.abs(num);
              x = 1;
           }
           if(isNaN(num)) num = "0";
              cents = Math.floor((num*100+0.5)%100);

           num = Math.floor((num*100+0.5)/100).toString();

           if(cents < 10) cents = "0" + cents;
              for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
                 num = num.substring(0,num.length-(4*i+3))+'.'
                       +num.substring(num.length-(4*i+3));
           ret = num + ',' + cents;
           if (x == 1) ret = ' - ' + ret;return ret;

        }    
          
        
      </script>
   